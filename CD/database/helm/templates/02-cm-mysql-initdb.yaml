apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-initdb-config
data:
  # ─────────────────────────────
# ConfigMap with init SQL only
# ─────────────────────────────
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-initdb-config
  namespace: product-dev
data:
  # Mysql init script
  init.sql: |
      /*
        MySQL Init Script (idempotent)
        - Creates custom probe user
        - Creates application database and tables
        - All users use mysql_native_password for consistency
      */
      
      CREATE USER IF NOT EXISTS 'healthcheck'@'%' IDENTIFIED WITH mysql_native_password BY 'p@ssword';
      GRANT USAGE ON *.* TO 'healthcheck'@'%';
      
      CREATE DATABASE IF NOT EXISTS product;
      USE product;
      
      CREATE TABLE IF NOT EXISTS product (
        id INT NOT NULL AUTO_INCREMENT,
        name VARCHAR(45) NOT NULL,
        brand VARCHAR(45) NOT NULL,
        madein VARCHAR(45) NOT NULL,
        price FLOAT NOT NULL,
        PRIMARY KEY (id)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
      
      CREATE USER IF NOT EXISTS 'product'@'%' IDENTIFIED WITH mysql_native_password BY 'product';
      GRANT ALL PRIVILEGES ON product.* TO 'product'@'%';
      
      FLUSH PRIVILEGES;

